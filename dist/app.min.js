window.onload=function(){function t(t){x=document.createElement("canvas"),x.width=f,x.height=v,x.id="mainCanvas",x.style.marginTop="40px",document.getElementById("container").appendChild(x),D=x.getContext("2d");var i=parseInt(Math.random()*O.length);q=O[i],E=new H,C=new G,h(),r();for(var e=0;7>e;e++){var s=parseInt(5*Math.random());R.push(s)}o()}function i(){for(var t=((new Date).getTime()-S)/1e3,i=0;t>k;)t-=k,i++;F=w+.03*i,console.log(F)}function e(){for(var t=0;l>t;t++)t%2===0?(D.strokeStyle=q.primary3,D.fillStyle=q.primary3):(D.strokeStyle=q.primary4,D.fillStyle=q.primary4),D.fillRect(t*u+(t+.5)*p+y,0,u+p,v)}function r(){window.addEventListener("keydown",function(t){[32,37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault()},!1),document.addEventListener("keydown",function(t){[37,39].indexOf(t.keyCode)>-1&&E.eventProcess(t,"keydown")},!0),document.addEventListener("keyup",function(t){[37,39].indexOf(t.keyCode)>-1&&E.eventProcess(t,"keyup")},!0),document.addEventListener("keyup",function(t){32===t.keyCode&&(null===I?o():(clearInterval(I),I=null))},!0),document.addEventListener("touchstart",function(t){this.touchStartHandle(t)}),document.addEventListener("touchend",function(t){this.touchEndHandle(t)}),document.addEventListener("touchmove",function(t){t.preventDefault()})}function s(){var t={"status-bar-fps":d,"status-bar-gamespeed":F,"status-bar-moespeed":E.speed,"status-bar-score":g,"status-bar-timecost":((new Date).getTime()-S)/1e3};for(var i in t)if(t.hasOwnProperty(i)){var e=document.getElementById(i);e.innerHTML=t[i]}}function a(t){s(),i(),E.checkRoadBlockStatus()}function n(t){D.clearRect(0,0,f,v),a(),e(),E.draw(),C.draw()}function o(){S=(new Date).getTime(),I=setInterval(function(){var t=((new Date).getTime()-S)/1e3;n(t)},d)}function h(){CanvasRenderingContext2D.prototype.fillRadiusRect=function(t,i,e,r,s,a,n){"undefined"==typeof s&&(s=5),"undefined"==typeof n&&(n=!0),this.beginPath(),this.moveTo(t+s,i),this.lineTo(t+e-s,i),this.quadraticCurveTo(t+e,i,t+e,i+s),this.lineTo(t+e,i+r-s),this.quadraticCurveTo(t+e,i+r,t+e-s,i+r),this.lineTo(t+s,i+r),this.quadraticCurveTo(t,i+r,t,i+r-s),this.lineTo(t,i+s),this.quadraticCurveTo(t,i,t+s,i),a&&this.fill(),n&&this.stroke()}}var d=10,l=5,u=100,c=150,p=5,y=10,m=7,f=l*u+(l+1)*p+2*y,v=600,k=10,w=2,x=null,D=null,g=0,E=null,C=null,S=null,B=1*v/3,R=[],T=0,I=null,F=w,A={primary0:"#5B0404",primary1:"#861C1C",primary2:"#D77272",primary3:"#FFB0B0",primary4:"#AE3F3F"},Y={primary0:"#5B3304",primary1:"#86551C",primary2:"#D7A872",primary3:"#FFDAB0",primary4:"#AE7A3F"},b={primary0:"#275103",primary1:"#447819",primary2:"#659B38",primary3:"#8EC065",primary4:"#BDE49E"},P={primary0:"#023735",primary1:"#11524F",primary2:"#458380",primary3:"#6D9E9C",primary4:"#266A67"},L={primary0:"#2B053D",primary1:"#44165A",primary2:"#7B4F8F",primary3:"#9C7AAD",primary4:"#5D2E74"},M={primary0:"#292626",primary1:"#615F5F",primary2:"#8E8D8D",primary3:"#BAB8B8",primary4:"#EDEBEB"},O=[A,Y,b,P,L,M],q=null,H=function(){this.headDirection=null,this.tailAnimation=!1,this.pos={x:f/2,y:2*v/3},this.speed=3,this.radius=15,this.checkRampartStatus=function(t){var i={x:this.pos.x+this.radius/2,y:this.pos.y+this.radius/2};t&&i.y<t.wallStartY+c&&i.y>t.wallStartY&&(i.x>0&&i.x<y||i.x>f-y&&i.x<f)&&(clearInterval(I),I=null)},this.checkRoadBlockStatus=function(t){var i={x:this.pos.x+this.radius/2,y:this.pos.y+this.radius/2};if(t&&i.y<t.startY+m&&i.y>t.startY){{var e=t.skipIndex*u+(t.skipIndex+2)*p;t.startY}i.x>e-p&&i.x<e+u+p?g++:(clearInterval(I),I=null)}},this.draw=function(t){this.updatePos(this.headDirection),D.strokeStyle=q.primary2,D.fillStyle=q.primary2,D.beginPath(),D.arc(this.pos.x+this.radius,this.pos.y+this.radius,this.radius,0,2*Math.PI),D.stroke()},this.eventProcess=function(t,i){"keydown"===i?this.headDirection=37===t.keyCode?"left":39===t.keyCode?"right":null:"keyup"===i&&(this.headDirection=null)},this.updatePos=function(t){switch(this.headDirection){case"left":case"up":t=-1;break;case"right":case"down":t=1}["left","right"].indexOf(this.headDirection)>-1&&(this.pos.x+=this.speed*t,this.pos.x>f?this.pos.x=0:this.pos.x<0&&(this.pos.x=f)),["up","down"].indexOf(this.headDirection)>-1&&(this.pos.y+=this.speed*t,this.pos.y>v-this.radius?this.pos.y=0:this.pos.y<-this.radius&&(this.pos.y=v),console.log(this.pos.y))}},j=function(t,i){this.startY=t,this.skipIndex=i,this.drawRow=function(){D.strokeStyle=q.primary0,D.fillStyle=q.primary1;for(var t=0;l>t;t++)t!==i&&D.fillRadiusRect(t*u+(t+1)*p+y,this.startY,u,m,m/2,!0,!0)}},z=function(t,i){this.displayDirection="v",this.thickness=y,this.length=c,this.gap=p,this.wallStartY=t,this.draw=function(t){D.strokeStyle=q.primary0,D.fillStyle=q.primary1,D.fillRadiusRect(0,this.wallStartY,this.thickness,this.length,this.thickness/2,!0,!0),D.fillRadiusRect(f-this.thickness,this.wallStartY,this.thickness,this.length,this.thickness/2,!0,!0)}},G=function(){this.draw=function(){if(B+=F,B>v+c+p){B=v,R.shift();var t=parseInt(5*Math.random());R.push(t)}T=B;var i=0;do{var e=new j(T-p,R[i]);if(e.drawRow(),E.checkRoadBlockStatus(e),i>=1&&Math.abs(R[i]-R[i-1])>=3)T-=p+c,i++;else{var r=new z(T,"v");r.draw(),E.checkRampartStatus(r),T-=p+c,i++}}while(T>-c)}};t()};